<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Itau Insights: Conversor Base64</title>
  <link rel="icon" type="image/x-icon" href="https://www.itau.com.br/media/dam/m/39c1bb1de2d2168/original/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="p-4 sm:p-6 lg:p-8">

  <!-- Input de Arquivo (Invisível) -->
  <input type="file" id="fileInput" accept=".json" class="hidden" />

  <!-- Container Principal -->
  <div id="appContainer" class="max-w-2xl mx-auto">
    
    <header class="mb-8">
      <div class="flex justify-center items-center gap-3 mb-3">
        <svg class="w-8 h-8 brand-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11.5147 28.4853C14.8118 31.7824 19.9575 33.75 25.5 33.75C31.0425 33.75 36.1882 31.7824 39.4853 28.4853C36.1882 25.1882 31.0425 23.2176 25.5 23.2176C19.9575 23.2176 14.8118 25.1882 11.5147 28.4853Z" fill="white" stroke="currentColor" stroke-width="3"/>
          <path d="M0 40H40V0H0V40ZM3.75 3.75H36.25V36.25H3.75V3.75Z" fill="currentColor"/>
        </svg>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand-header">
          Conversor JSON para Base64
        </h1>
      </div>
      <p class="text-sm sm:text-base text-gray-600 text-center">
        Uma ferramenta para ofuscar arquivos de dados para o Itau Insights.
      </p>
    </header>

    <main class="bg-white rounded-xl shadow-lg p-6 sm:p-8 space-y-6">
      
      <!-- Passo 1: Upload -->
      <div>
        <h2 class="text-lg font-semibold text-gray-800 mb-2">1. Selecione o arquivo JSON</h2>
        <label 
          for="fileInput" 
          class="w-full inline-flex items-center justify-center gap-2 px-6 py-4 brand-bg text-white text-lg font-semibold rounded-lg shadow-lg hover:shadow-xl cursor-pointer transition-all transform hover:-translate-y-0.5"
        >
          <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          Carregar Arquivo
        </label>
        <p id="fileName" class="text-center text-sm text-gray-500 mt-3">Nenhum arquivo selecionado.</p>
      </div>

      <!-- Passo 2: Conversão -->
      <div>
        <h2 class="text-lg font-semibold text-gray-800 mb-2">2. Converta para Base64</h2>
        <button
          id="convertBtn"
          disabled
          class="w-full px-6 py-3 text-lg font-semibold rounded-lg transition-colors shadow-md disabled:bg-gray-300 disabled:cursor-not-allowed disabled:shadow-none bg-gray-700 hover:bg-gray-800 text-white"
        >
          Converter
        </button>
      </div>

      <!-- Mensagem de Erro -->
      <div id="errorContainer" class="hidden p-4 bg-red-100 border border-red-300 text-red-800 rounded-lg text-sm">
        <p id="errorMessage"></p>
      </div>

      <!-- Passo 3: Resultado -->
      <div id="resultContainer" class="hidden animate-fadeIn space-y-4 border-t border-gray-200 pt-6">
        <h2 class="text-lg font-semibold text-gray-800">3. Resultado</h2>
        <div class="p-4 bg-green-100 border border-green-300 text-green-800 rounded-lg text-sm">
          <p>✅ Conversão concluída com sucesso!</p>
        </div>
        
        <div>
          <label for="base64Output" class="text-sm font-medium text-gray-700">Conteúdo em Base64:</label>
          <textarea 
            id="base64Output" 
            rows="4" 
            readonly 
            class="mt-1 w-full p-2 text-xs bg-gray-100 border-2 border-gray-300 rounded-lg shadow-inner focus:outline-none"
          ></textarea>
        </div>

        <button
          id="downloadBtn"
          class="w-full inline-flex items-center justify-center gap-2 px-6 py-4 brand-bg text-white text-lg font-semibold rounded-lg shadow-lg hover:shadow-xl cursor-pointer transition-all transform hover:-translate-y-0.5"
        >
          <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Baixar Arquivo Convertido
        </button>
      </div>
    </main>
  </div>

  <script>
    // Elementos da UI
    const ui = {
      fileInput: document.getElementById('fileInput'),
      fileName: document.getElementById('fileName'),
      convertBtn: document.getElementById('convertBtn'),
      errorContainer: document.getElementById('errorContainer'),
      errorMessage: document.getElementById('errorMessage'),
      resultContainer: document.getElementById('resultContainer'),
      base64Output: document.getElementById('base64Output'),
      downloadBtn: document.getElementById('downloadBtn'),
    };

    // Estado da aplicação
    let selectedFile = null;
    let base64Content = '';
    let originalFileName = '';

    // Funções
    function resetState() {
      ui.resultContainer.classList.add('hidden');
      ui.errorContainer.classList.add('hidden');
      base64Content = '';
      originalFileName = '';
    }

    function showError(message) {
      ui.errorMessage.textContent = message;
      ui.errorContainer.classList.remove('hidden');
    }

    // Manipuladores de Eventos
    ui.fileInput.addEventListener('change', (event) => {
      resetState();
      selectedFile = event.target.files[0];
      if (selectedFile) {
        ui.fileName.textContent = `Arquivo: ${selectedFile.name}`;
        ui.convertBtn.disabled = false;
      } else {
        ui.fileName.textContent = 'Nenhum arquivo selecionado.';
        ui.convertBtn.disabled = true;
      }
    });

    ui.convertBtn.addEventListener('click', () => {
      if (!selectedFile) return;
      resetState();

      const reader = new FileReader();

      reader.onload = (e) => {
        const content = e.target.result;
        try {
          // 1. Validar se é um JSON
          JSON.parse(content);

          // 2. Converter para Base64
          base64Content = btoa(content);
          originalFileName = selectedFile.name;

          // 3. Atualizar a UI com o sucesso
          ui.base64Output.value = base64Content;
          ui.resultContainer.classList.remove('hidden');

        } catch (error) {
          showError('Erro: O arquivo selecionado não é um JSON válido.');
          console.error("JSON Parse Error:", error);
        }
      };

      reader.onerror = () => {
        showError('Erro ao ler o arquivo.');
      };

      reader.readAsText(selectedFile);
    });

    ui.downloadBtn.addEventListener('click', () => {
      if (!base64Content || !originalFileName) return;

      // Cria um Blob com o conteúdo Base64
      const blob = new Blob([base64Content], { type: 'text/plain' });

      // Gera um nome para o novo arquivo
      const newFileName = originalFileName.replace('.json', '_b64.json');

      // Cria um link temporário para o download
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = newFileName;
      
      // Simula o clique para iniciar o download e depois remove o link
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
    });
  </script>

</body>
</html>